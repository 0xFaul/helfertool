{% extends "base.html" %}
{% load i18n %}
{% load bootstrap3 %}

{% load lookup_shift %}

{% block title %}{% blocktrans %}Register for {{ event }} as helper{% endblocktrans %}{% endblock %}

{% block content %}
    <h1>{{ event }}</h1>

    {{ event.text | safe }}

    <form action="{% url 'form' event.url_name %}" method="post">
        {% csrf_token %}

        <h2>{% trans "Jobs" %}</h2>
        {# list of all jobs and shifts #}

        {% for job in event.job_set.all %}
            <h3>{{ job.name }}</h3>
            <p>{{ job.description | safe }}</p>

            <table class="shifts">
                <tr>
                    {% for day, shifts in job.shifts_by_day.items %}
                        <th>{{ day }}</th>
                    {% endfor %}
                </tr>
                <tr>
                    {% for day, shifts in job.shifts_by_day.items %}
                        <td>
                        {% for shift in shifts %}
                            {# checkbox #}
                            <label>
                                {{ form | lookup_shift:shift.pk }}

                                {# time #}
                                {% if shift.is_full %}
                                    <del>{{ shift.time_hours }}</del>
                                {% else %}
                                    {{ shift.time_hours }}
                                {% endif %}
                            </label>

                            {# number of helpers #}
                            {% if event.show_public_numbers %}
                            <span class="numbers">
                                ({{ shift.num_helpers }}/{{ shift.number }})
                            </span>
                            {% endif %}

                            <br />
                        {% endfor %}
                        </td>
                    {% endfor %}
                </tr>
            </table>
        {% endfor %}

        <h2>{% trans "Personal data" %}</h2>
        {# personal data, nothing special... #}

        <table class="inputform">
            <colgroup>
                <col span="1" style="width: 10em;">
            </colgroup>
            <tr>
                <td>{{ form.prename.label }}</td>
                <td>{{ form.prename }}{{ form.prename.errors }}{{ form.prename.description }}</td>
            <tr>

            <tr>
                <td>{{ form.surname.label }}</td>
                <td>{{ form.surname }}{{ form.surname.errors }}</td>
            <tr>

            <tr>
                <td>{{ form.email.label }}</td>
                <td>{{ form.email }}{{ form.email.errors }}</td>
            <tr>

            <tr>
                <td>{{ form.phone.label }}</td>
                <td>{{ form.phone }}{{ form.phone.errors }}</td>
            <tr>

            {% if event.ask_shirt %}
            <tr>
                <td>{{ form.shirt.label }}</td>
                <td>{{ form.shirt }}{{ form.shirt.errors }}</td>
            <tr>
            {% endif %}

            <tr id="infection_instruction_field">
                <td>{{ form.infection_instruction.label }}</td>
                <td>{{ form.infection_instruction }}{{ form.infection_instruction.errors }}
                <p>{{ form.infection_instruction.help_text }}</p></td>
            <tr>

            {% if event.ask_vegetarian %}
            <tr>
                <td>{{ form.vegetarian.label }}</td>
                <td><label>{{ form.vegetarian }} {% trans "Vegetarian food" %}</label>{{ form.vegetarian.errors }}
                <p>{{ form.vegetarian.help_text }}</p></td>
            <tr>
            {% endif %}

            <tr>
                <td>{{ form.comment.label }}</td>
                <td>{{ form.comment }}{{ form.comment.errors }}</td>
            <tr>
        </table>

        {{ form.non_field_errors }}

        <input type="submit" value="{% trans "Register" %}" />

        <script>
            function handle_infection_instruction()
            {
                var show_field = 0;

                // iterate over all relevant checkboxes
                var boxes = document.getElementsByClassName("infection_instruction");
                for(var i=0; i < boxes.length; i++)
                {
                    if(boxes[i].checked)
                    {
                        show_field = 1;
                        break;
                    }
                }

                // show or hide input field
                if(show_field)
                    document.getElementById("infection_instruction_field").style.display = 'table-row';
                else
                    document.getElementById("infection_instruction_field").style.display = 'none';


                // If you ask: Yes, I know JQuery
            }

            handle_infection_instruction();
        </script>
    </form>

    {{ event.imprint | safe }}
{% endblock %}
