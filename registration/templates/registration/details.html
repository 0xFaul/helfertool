{% extends "base.html" %}

{% block content %}
    <h1>Helfer für {{ event.name }}</h1>

    <ul>
        <li><a href="{% url 'details' event.url_name %}">Übersicht</a></li>
        {% for j in event.job_set.all %}
            <li><a href="{% url 'job' event.url_name j.pk %}">{{ j.name }}</a></li>
        {% endfor %}
    </ul>

    {# show one job #}
    {% if job %}
        <h2>{{ job.name }}</h2>

        <p><a href="{% url 'exceljob' event.url_name job.pk %}">Für Excel exportieren</a></p>

        {% regroup  job.shift_set.all|dictsort:"begin" by begin|date:"d.m.Y" as shifts_by_day %}
        {% for day in shifts_by_day %}
            <h3>{{ day.grouper }}</h3>
            {% for shift in day.list|dictsort:"begin" %}
                <h4>{{ shift.begin | date:"H:i" }} - {{ shift.end | date:"H:i" }}
                    ({{ shift.helper_set.count }} von {{ shift.number}})</h4>
                <table class="helpers">
                    <tr>
                        <th>Vorname</th>
                        <th>Nachname</th>
                        <th>E-Mail</th>
                        <th>Handy</th>
                        <th>T-Shirt</th>
                        <th>Vegetarier</th>
                        <th>Kommentar</th>
                        <th>Anmeldezeit</th>
                    </tr>
                {% for helper in shift.helper_set.all|dictsort:"timestamp" %}
                    <tr>
                        <td>{{ helper.prename }}</td>
                        <td>{{ helper.surname }}</td>
                        <td>{{ helper.email }}</td>
                        <td>{{ helper.phone }}</td>
                        <td>{{ helper.get_shirt_display }}</td>
                        <td>{{ helper.vegetarian | yesno }}</td>
                        <td>{{ helper.comment }}</td>
                        <td>{{ helper.timestamp }}</td>
                    </tr>
                {% endfor %}
                </table>
            {% endfor %}
        {% endfor %}
    {# show one job #}
    {% else %}
        <h2>Übersicht</h2>

        <p><a href="{% url 'excel' event.url_name %}">Alles für Excel exportieren</a></p>
        <p>TODO: statistics</p>
    {% endif %}
{% endblock %}
